---
title: "Week 2: Maps with Multiple Layers"
author: "Catherine Brockway"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: flatly
    toc: TRUE
    toc_float: TRUE
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("vembedr")
```

<img src="`r here::here('Images/ALL-SPICE.png')`" width="240" /> <img src="`r here::here('Images/3_CIFAL.png')`" width="200" />

## GIS Concepts

Please read the following short chapter in the free, online textbook *Intro to GIS and Spatial Analysis* by Manuel Gimond. Write down any questions you have and bring them to office hours to discuss. 

[Chapter 4 Symbolizing Features](https://mgimond.github.io/Spatial/symbolizing-features.html)

[Chapter 5 Statistical Maps](https://mgimond.github.io/Spatial/statistical-maps.html)

[Chapter 6 Pitfalls to Avoid](https://mgimond.github.io/Spatial/pitfalls-to-avoid.html)

[Chapter 5 Good Map Making Tips](https://mgimond.github.io/Spatial/good-map-making-tips.html)

Refer back to these chapters as you create your maps throughout the rest of the course. 

# Assignment: Locator Map Tutorial

This week we will learn how to make a "locator map", that highlights an area in a larger region to help the audience understand the context of a region. You will create one like this for your final project to highlight the area you are focusing on. 

This week we will continue using the Natural Earth dataset, but we will begin building maps with multiple layers. 

Packages required for this tutorial:

- `tidyverse` (which includes `ggplot2`, more info available [here](https://www.tidyverse.org/))

- `sf` (more info available [here](https://r-spatial.github.io/sf/index.html) and [here](https://r-spatial.github.io/sf/articles/sf1.html))

- `rnaturalearth` (more info available[here](https://docs.ropensci.org/rnaturalearth/articles/rnaturalearth.html))

- `rnaturalearthdata` (this provides more data, and higher resolution data)

- `rnaturalearthhires` (this provides the highest resolution data, which is best for mapping small areas)

You should have all these packages installed from last week, so you just need to load them for this session by running the code chunk below.  

```{r}
library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(rnaturalearthhires)
```

Let's also go ahead and recreate the `world` dataframe that we used last week. 

```{r}
world <- ne_countries(scale = "medium", returnclass = "sf")
class(world)
```

## Make your first regional map

Now let's start thinking about the area of the world you want to focus on for your project (your target area). I am thinking about moving somewhere in Washington (state), USA in the next couple of years, so I will be focusing on that area so that I can learn more about it. 

Choose state/province/region/island that you want to focus on for your final project. 

We can create a "bounding box" for our existing `world` dataset that will "zoom in" to the general area around our target area. First, you need to decide what the boundaries of your map will be. [Google Earth](https://earth.google.com/web/) is a good tool to find latitudes and longitudes. Make sure you are making the bounding box big enough that you can see the whole region around your target area.

**Challenge 1: Create a bounding box for your region**. This should be the region around the your target area. 

```{r}
ggplot(data = world) +
    geom_sf() +
    coord_sf(xlim = c(-130, -110), ylim = c(40, 50), expand = FALSE) +
    ggtitle("Pacific Northwest of the United States")+
    theme_void()

```

# Amber's Challenge #1 Answer
I am choosing Alabama, since that is where my dad currently lives. I'm using Google Earth to create a bounding box. But, I want the bounding box to include Mississippi, where my grandma lives, and Georgia, where I used to live.

```{r}
ggplot(data = world) +
    geom_sf() +
    coord_sf(xlim = c(-92, -80), ylim = c(29, 36), expand = FALSE) +
    ggtitle("Alabama (Southeast USA)")+
    theme_minimal() # I'm adding lat/long lines for now, to orient myself as I build my map
```


This gives us a very simple map which doesn't provide much information. We will need to add more data layers to make the map more meaningful.

Let's create a layer that includes state/province level data. 

**Challenge 2: Create a new layer with state/province data for your the country of your final project area**. 

```{r}
states <- (ne_states(country = "United States of America"))
```

# Amber's Challenge 2 Answer
```{r}
# will need rnaturalearthhires. try using:
# devtools::install_github("ropensci/rnaturalearthhires")

# solution from Cat
# remotes::install_github("ropensci/rnaturalearthhires")
# install.packages("rnaturalearthhires", repos = "https://ropensci.r-universe.dev", type = "source")

states <- (ne_states(country = "United States of America"))
```


Now we can add this layer to our existing map with a second `geom_sf`. 

**Challenge 3: Add your new "state" layer to the map.**

```{r}
ggplot() +
    geom_sf(data = world) +
    geom_sf(data = states) +
    coord_sf(xlim = c(-130, -110), ylim = c(40, 50), expand = FALSE) +
    ggtitle("Pacific Northwest of the United States")+
    theme_void()

```

# Amber's Challenge 3 Answer

```{r}
ggplot(data = world) +
    geom_sf(data = world) +
    geom_sf(data = states) +
    coord_sf(xlim = c(-92, -80), ylim = c(29, 36), expand = FALSE) +
    ggtitle("Alabama (Southeast USA)")+
    theme_minimal() # I'm adding lat/long lines for now, to orient myself as I build my map
```


To see what other cultural/political features are available, use the function `df_layers_cultural`. 

```{r}
df_layers_cultural
```

For example, you may want to use the `admin_0_pacific_groupings` data if you are focused on Pacific islands. 

```{r}
pacific_groups <- ne_download(
  scale = 50,
  type = "admin_0_pacific_groupings"
)
```

Here is an example map focused on the Solomon Islands. 
```{r}
ggplot() +
  geom_sf(data = pacific_groups)+
  geom_sf(data = world) +
  geom_sf_text(data = world, aes(label = admin))+
coord_sf(crs = "+proj=ortho +lat_0=0 +lon_0=-160 ") +
  coord_sf(xlim = c(145, 175), ylim = c(-20, 5), expand = FALSE) +
  ggtitle("Solomon Islands", subtitle = "Showing Pacific Island Groupings")+
  theme_void()
```


Now let's add some physical features, like major lakes and rivers.

```{r}
# lakes
lakes50 <- ne_download(
  scale = 50, 
  type = "lakes", 
  category = "physical")

# rivers
rivers50 <- ne_download(
  scale = 50,
  type = "rivers_lake_centerlines",
  category = "physical",
  returnclass = "sf"
)

```

Now let's add the lakes and rivers to our map. 

**Challenge 4: Update the `coord_sf` with your bounding box and your `ggtitle` with your own title.** The `states` layer should also now be updated with your new `states` dataframe you created in Challenge 2. 

# Amber's Challenge 4 Answer

I wanted to add railroads, too. Just editing your existing code chunk.

```{r}
# lakes
lakes50 <- ne_download(
  scale = 50, 
  type = "lakes", 
  category = "physical")

# rivers
rivers50 <- ne_download(
  scale = 50,
  type = "rivers_lake_centerlines",
  category = "physical",
  returnclass = "sf"
)

# railroads
railroads10 <- ne_download(
  scale = 10, # only available in scale10, so let's see what that's about
  type = "railroads",
  category = "cultural",
  returnclass = "sf"
)
# seems like railroads has more data than railroads_north_america. wonder what the difference is


ggplot() +
    geom_sf(data = world) +
    geom_sf(data = states) +
    geom_sf(data = lakes50) +
    geom_sf(data = rivers50) + 
    geom_sf(data = railroads10) + # whoa, crazy
    coord_sf(xlim = c(-92, -80), ylim = c(29, 36), expand = FALSE) +
    ggtitle("Alabama (Southeast USA)")+
    theme_minimal()

```

Now let's choose colors for all of our layers, and add some labels from the `states` layer with a `geom_text` layer. 

**Challenge 5: Update the `coord_sf` with your bounding box and your `ggtitle` with your own title. Change at least one of the colors in the `ggplot` code**. You can use color names like I have here, or you can specify a color using the hex code.

# Amber's Challenge 5 (editing existing code)
```{r}
ggplot() +
    geom_sf(data = world, fill = "white") +
    geom_sf(data = states, fill = "antiquewhite", size = 0.25) +
    geom_sf(data = lakes50, fill = "cyan3", color = "darkcyan") +
    geom_sf(data = rivers50, color = "cyan3", size = 0.15) +
    geom_sf(data = railroads10, color = "goldenrod", size = 0.15, linetype = "dashed") + 
    geom_sf_text(data = states, aes(label = name), size = 3, fontface = "bold", nudge_y = states$nudge_y) +
    coord_sf(xlim = c(-92, -80), ylim = c(29, 36), expand = FALSE) +
    ylab("Latitude") +
    xlab("Longitude") +
    ggtitle("Alabama (Southeast USA)")+
    theme_minimal()
```

For our final addition, let's highlight the specific area we will be focusing on. To do this, we will create a new layer that only includes the state (or province) where we will focus on for our project. 

**Challenge 6: Update the name of the state/province that you are focused on for your project.** Remember to change the name of the data object (to the left of the `<-`) to your target area. 
# Amber's Challenge 6 Answer 
```{r}
washington <- states %>%
  filter(name == "Washington")

# Amber added
alabama <- states %>%
  filter(name == "Alabama")
```

Now let's add that as a layer (the last `geom_sf` in our code) on our map, use the same fill color as the other states, and color the border red. We want this layer to be on top of the other layers on our map, so it should come after (below) the other `geom_sf` lines of our code. The order of our layers is very important!

**Challenge 7: Update the code below with all of your changes.** You should be changing at least one color, the name of the data object with your target area (in the fifth `geom_sf`), the bounding box, and the title and subtitle. 

#Amber's Challenge 7 Answers (edited existing code)
```{r, warning=FALSE}
# add some points while we're here
points <- data.frame(
  longitude = c(-87.5391, -90.4024, -81.5580),
  latitude = c(30.4105, 32.8468, 30.7300),  
  label = c("Lillian, AL", "Yazoo City, MS", "St. Mary's, GA")
  )

# add another layer to highlight the Mississippi river, too
miss_river <- rivers50 %>%
  filter(name == "Mississippi") 

ggplot() +
    geom_sf(data = world, fill = "white") +
    geom_sf(data = states, fill = "antiquewhite", size = 0.25) +
    geom_sf(data = alabama, fill = "#A81C1C", color = "#A81C1C")+
    geom_sf(data = lakes50, fill = "cyan3", color = "darkcyan") +
    geom_sf(data = rivers50, color = "cyan3", size = 0.15) +
    geom_sf(data = railroads10, color = "goldenrod", size = 0.15, linetype = "dashed") + 
    geom_sf(data = miss_river, color = "#4682B4", size = 20) +
    geom_point(data = points, aes(x = longitude, y = latitude), color = "black", size = 2, shape = 18) +
    geom_label(data = points, aes(x = longitude, y = latitude, label = label), size = 2, vjust = -.3) +
    geom_sf_text(data = states, aes(label = name), size = 3, fontface = "bold", nudge_y = states$nudge_y) +
    coord_sf(xlim = c(-92, -80), ylim = c(29, 36), expand = FALSE) +
    ylab("Latitude") +
    xlab("Longitude") +
    ggtitle("Roll Tide!", subtitle = "Alabama (Southeast USA)")+
    theme_bw() 

# I included some questions below, as I consider my Final Challenge.
```

# Final Challenge Preparation

Think about what kinds of data you want to include in your locator map for your final project. Check out the Natural Earth [features](https://www.naturalearthdata.com/features/) to see what is available, and try to retrieve the data and add different layers to your map. You can also remove the lakes and rivers layers if you want. You can go ahead and add your locator map draft to your Final_Challenge.rmd.

# QUESTIONS from Amber
```{r}
# I want to add a legend, but the only way I knew how got too messy. I wonder if there is a GIS-approved way (that isn't just ggplot brute force).

# I'm also curious about more detailed data in general. I know there are more rivers and streams and railroads than presented here. What else do I want to add? Farm land? Mountains? National Forests or Parks in the area?
  
# Lastly, I wanted to add a layer that draws the Mississippi river really wide, but wasn't sure how to accomplish that. I was able to change the color, but note that my code has size = 20 and it is not making a difference. I used st_geometry_type(miss_river) to confirm that the data geometry is line data.
```



# More resources

The resources in this section are not required for this course! They are provided in case you want to learn more. Feel free to come back to them after you finish the course.

[Locator Map, Wikipedia](https://en.wikipedia.org/wiki/Locator_map)

In this course, we are focused on retrieving spatial data using APIs and assigning them as dataframes and `sf` objects. However, there is a ton of data out there that isn't easily accessed using APIs. This data needs to be downloaded directly from a data source onto your computer, and then "loaded" or "read" in to R. At some point in your GIS journey, you will want to become familiar with different spatial file types, and how to load them into R to work with them. 

[The Ultimate List of GIS Formats and Geospatial File Extensions](https://gisgeography.com/gis-formats/)

[GIS File Formats](https://library.carleton.ca/guides/help/gis-file-formats)

[Reading and writing spatial data in R](https://mgimond.github.io/Spatial/reading-and-writing-spatial-data-in-r.html)

Although we are not covering spatial analysis in this course, at some point you should learn about what kinds of spatial analysis are possible, and what kinds of questions they can answer. Here are some helpful resources when you are ready for them:

This textbook is old, so the code they are using is likely not the best option these days, but the book is still very helpful for understanding the major methods of data analysis. [Spatial Analysis with R](http://gis.humboldt.edu/OLM/r/Spatial%20Analysis%20With%20R.pdf)

This resource is more up-to-date, and mostly focuses on spatial analysis of raster data using the `terra` package. [Spatial Data Science with R and `terra`](http://gis.humboldt.edu/OLM/r/Spatial%20Analysis%20With%20R.pdf)

This chapter is focused on some basic vector data analysis. [Intro to spatial analysis in R: Vector Data](https://doi90.github.io/EE_Intro_Spatial_Workshop/vector-data.html)